-- GET THE MOST USERS CONTRIBUTE IN THE SYSTEM ACCORDING TO THE NUMBER OF SONGS THEY HEARD IN ALL SESSIONS

SELECT *, DENSE_RANK() OVER(ORDER BY SONGS_NUMBER) USER_RANK
FROM 
(
SELECT DISTINCT SESSION_ID, USER_ID, USER_FIRST_NAME, USER_GENDER, USER_LAST_NAME, SONG_NAME,
COUNT(SONG_NAME) OVER (PARTITION BY USER_ID) SONGS_NUMBER
FROM EVENTS
WHERE SONG_NAME IS NOT NULL AND SONG_PLAYED = 'NextSong') SUB_QUERY;