-- ANALYSIS IF THE PROPABILITY OF EACH USER SUCCESS TO ACCESS SONG (METHOD IS 200) FROM ALL REQUESTS 


SELECT DISTINCT USER_ID, USER_FIRST_NAME, USER_LAST_NAME, NUMBER_OF_TRAILS, SUCCESSFUL_TRAILS, 
CAST(SUCCESSFUL_TRAILS AS FLOAT) /NUMBER_OF_TRAILS SUCCESSFUL_PERCENTAGE
FROM 
(
SELECT USER_ID, USER_FIRST_NAME, USER_LAST_NAME
,COUNT(USER_ID) OVER(PARTITION BY USER_ID) NUMBER_OF_TRAILS
, COUNT (CASE WHEN SONG_STATUS = 200 THEN 1 END) OVER(PARTITION BY USER_ID) SUCCESSFUL_TRAILS 
FROM EVENTS
WHERE SONG_NAME IS NOT NULL AND SONG_PLAYED = 'NextSong' ) SUB_QUERY
ORDER BY USER_ID;
